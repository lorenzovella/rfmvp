{% load static %}
<html>
  <head>
    <title>Ração do Futuro</title>

    <link rel="stylesheet" href="{% static css/bootstrap.min.css %}">
    <link rel="stylesheet" href="{% static css/jquery-ui.css %}">
    <link rel="stylesheet" href="{% static css/jquery-ui.theme.css %}">
    <link rel="stylesheet" href="{% static css/.css %}">
    <script src="{% js/bootstrap.bundle.min.js %}"
    <script src="{% js/jquery-3.5.1.min.js %}"
    <script src="{% js/jquery-ui.min.js %}"
    <script src="{% js/extra.js %}"

    <script source
  </head>
  <body>
    <div id="content" class="container">
      <h2>Home: <a href="{% url 'index' %}">rfmvp</a></h2>
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Your Apps</h5>
          <p class="card-text">{% block content %}{% endblock %}</p>
        </div>
      </div>
    </div>
  <div class="container mt-3">
    <div class="card">
    <div class="card-body">
        <h5 class="card-title">WebSocket Messages</h5>
        <p class="card-text"><code id="messages"></code></p>
    </div>
    </div>
</div>
<script>
    var wsprotocol = window.location.protocol === 'http:' ? 'ws://' : 'wss://'
    var ws = wsprotocol + window.location.hostname + ':' + window.location.port + '/ws/'
    var socket = new WebSocket(ws);

    socket.onopen = function() {
      // Web Socket is connected, send some text
      socket.send("Text from Javascript");
      // Send some binary data
      socket.send(new Blob(["Bytes from Javascript"]));
    };

    socket.onmessage = function (evt) {
      console.log(evt)
      var received_msg = evt.data;
      console.log("Message received...", received_msg);
      var node = document.createElement("div");
      if (received_msg instanceof Blob) {
        received_msg.text().then(function (received_text) {
          var textnode = document.createTextNode("> " + received_text);
          node.appendChild(textnode);
          document.getElementById("messages").appendChild(node);
        })
      } else {
        var textnode = document.createTextNode("> " + received_msg);
        node.appendChild(textnode);
        document.getElementById("messages").appendChild(node);
      }
    };
  </script>
  </body>
</html>
